{% extends "base.html" %}

{% block title %}Cadastrar Patrimônio - Sistema de Patrimônio Escolar{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-plus-circle me-2"></i>
                        Cadastrar Novo Patrimônio
                    </h4>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('cadastrar') }}" enctype="multipart/form-data" class="needs-validation" novalidate>
                        
                        <!-- Informações Básicas -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Informações Básicas
                                </h5>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="nome" class="form-label">Nome do Patrimônio *</label>
                                <input type="text" class="form-control" id="nome" name="nome" required 
                                       placeholder="Ex: Mesa Escritório, Cadeira Estudante, Computador">
                                <div class="invalid-feedback">
                                    Por favor, informe o nome do patrimônio.
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="origem" class="form-label">Origem/Quem Doou *</label>
                                <input type="text" class="form-control" id="origem" name="origem" required 
                                       placeholder="Ex:ETEC, ANAC, DOACAO PARTICULAR"
                                       oninput="formatarMaiusculasSemAcentos(this)">
                                <div class="invalid-feedback">
                                    Por favor, informe a origem/doação.
                                </div>
                            </div>
                            
                            <div class="col-12 mb-3">
                                <label for="descricao" class="form-label">Descrição *</label>
                                <textarea class="form-control" id="descricao" name="descricao" rows="3" required 
                                          placeholder="Descreva detalhes, características, especificações..."></textarea>
                                <div class="invalid-feedback">
                                    Por favor, informe uma descrição.
                                </div>
                            </div>
                        </div>

                        <!-- Localização e Condição -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-map-marker-alt me-2"></i>
                                    Localização e Estado
                                </h5>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="localizacao" class="form-label">Localização *</label>
                                <input type="text" class="form-control" id="localizacao" name="localizacao" required 
                                       placeholder="Ex: Sala 1, Laboratório, Biblioteca">
                                <div class="invalid-feedback">
                                    Por favor, informe a localização.
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="condicao" class="form-label">Condição *</label>
                                <select class="form-select" id="condicao" name="condicao" required>
                                    <option value="">Selecione a condição...</option>
                                    <option value="Ótimo">Ótimo</option>
                                    <option value="Bom">Bom</option>
                                    <option value="Recuperável">Recuperável</option>
                                    <option value="Péssimo">Péssimo</option>
                                </select>
                                <div class="invalid-feedback">
                                    Por favor, selecione a condição.
                                </div>
                            </div>
                        </div>

                        <!-- Informações Adicionais -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-barcode me-2"></i>
                                    Informações Adicionais
                                </h5>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label for="marca" class="form-label">Marca</label>
                                <input type="text" class="form-control" id="marca" name="marca" 
                                       placeholder="Ex: Intelbras, Dell, Multilaser">
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label for="codigo_doador" class="form-label">Código do Doador</label>
                                <input type="text" class="form-control" id="codigo_doador" name="codigo_doador" 
                                       placeholder="Apenas 7 números"
                                       pattern="[0-9]{7}"
                                       maxlength="7"
                                       oninput="validarApenasNumeros(this)">
                                <div class="invalid-feedback">
                                    O código deve conter exatamente 7 números.
                                </div>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label for="codigo_cps" class="form-label">Código CPS</label>
                                <input type="text" class="form-control" id="codigo_cps" name="codigo_cps" 
                                       placeholder="Apenas 7 números"
                                       pattern="[0-9]{7}"
                                       maxlength="7"
                                       oninput="validarApenasNumeros(this)">
                                <div class="invalid-feedback">
                                    O código deve conter exatamente 7 números.
                                </div>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label for="quantidade" class="form-label">Quantidade *</label>
                                <input type="number" class="form-control" id="quantidade" name="quantidade" 
                                       value="1" min="1" required>
                                <div class="invalid-feedback">
                                    A quantidade deve ser maior que zero.
                                </div>
                            </div>
                        </div>

                        <!-- Imagem -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-image me-2"></i>
                                    Imagem do Patrimônio
                                </h5>
                            </div>
                            
                            <div class="col-12 mb-3">
                                <label for="imagem" class="form-label">Foto do Patrimônio (Opcional)</label>
                                <input type="file" class="form-control" id="imagem" name="imagem" 
                                       accept=".png,.jpg,.jpeg,.gif,.webp">
                                <small class="form-text text-muted">
                                    Formatos permitidos: PNG, JPG, JPEG, GIF, WEBP (Máx: 16MB)
                                </small>
                            </div>
                        </div>

                        <!-- Botões -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a href="{{ url_for('listar') }}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-2"></i>Voltar
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>Cadastrar Patrimônio
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Função para formatar texto em MAIÚSCULAS sem acentos
function formatarMaiusculasSemAcentos(input) {
    // Remove acentos
    let texto = input.value.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    // Converte para maiúsculas
    texto = texto.toUpperCase();
    // Atualiza o valor do input
    input.value = texto;
}

// Função para validar apenas números
function validarApenasNumeros(input) {
    // Remove qualquer caractere que não seja número
    input.value = input.value.replace(/[^0-9]/g, '');
    
    // Limita a 7 caracteres
    if (input.value.length > 7) {
        input.value = input.value.slice(0, 7);
    }
}

// Aplica a formatação quando a página carrega (para valores pré-existentes)
document.addEventListener('DOMContentLoaded', function() {
    const origemInput = document.getElementById('origem');
    if (origemInput && origemInput.value) {
        formatarMaiusculasSemAcentos(origemInput);
    }
    
    // Aplica validação numérica nos campos de código
    const codigoDoador = document.getElementById('codigo_doador');
    const codigoCps = document.getElementById('codigo_cps');
    
    if (codigoDoador) {
        codigoDoador.addEventListener('input', function() {
            validarApenasNumeros(this);
        });
    }
    
    if (codigoCps) {
        codigoCps.addEventListener('input', function() {
            validarApenasNumeros(this);
        });
    }
    
   
    const form = document.querySelector('form');
    form.addEventListener('submit', function(event) {
        const origemInput = document.getElementById('origem');
        if (origemInput && !origemInput.value.trim()) {
            event.preventDefault();
            event.stopPropagation();
            origemInput.classList.add('is-invalid');
        }
        
        // Validação dos códigos (se preenchidos)
        const codigoDoador = document.getElementById('codigo_doador');
        const codigoCps = document.getElementById('codigo_cps');
        
        if (codigoDoador && codigoDoador.value && codigoDoador.value.length !== 7) {
            event.preventDefault();
            event.stopPropagation();
            codigoDoador.classList.add('is-invalid');
        }
        
        if (codigoCps && codigoCps.value && codigoCps.value.length !== 7) {
            event.preventDefault();
            event.stopPropagation();
            codigoCps.classList.add('is-invalid');
        }
    });
});
</script>
{% endblock %}
